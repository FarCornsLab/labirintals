# Клиент-сервер API

## Базовый синтаксис команды

### Команды от сервера
    {
        "cmd": "get_server_list",
        "params": {

        }
    }
    
### Команды от клиента
    {
        "cmd": "get_server_list",
        "сid": 12345,
        "params": {

        }
    }

* `cmd` (string) - команда серверу, описание команд и их параметры см. ниже;
* `cid` (int) - внутренне id игрока выдоваймый сервером;
* `params` - обьект с параметрами команды, см. описание команд.
   
## Базовые модели данных

#### `player`:
Структура описания игрока.  
Поля:
* `name` (string) - имя игрока;
* `oid` (int) - общедоступный id игрока.
    
#### `error`:
Структура описывающая ошибку.
Поля:
* `code` (int) - код ошибки;
* `message` (string) - сообщение об ошибке.

## Команды начало игры


#### `connection`:
Присоединение к игре. Отправляется без поля `cid`.  
От: `client`.  
Параметры:  
* `name` (string) - имя присоединяемого клиента.  

Ответ: `connection_answer`.  
Пример запроса:

    {
        "cmd": "connection",
        "params": {
            "name": "Bender Bending Rodríguez"
        }
    }

#### `connection_answer`:
Ответ на присоединение к игре.  
От: `server`.  
Параметры:  
* `oid` (int) - общедоступный id игрока;
* `сid` (int) - внутренне id игрока;
* `error` (`error`) - поле ошибки (необязательное, в случе её отсутствия).

Пример ответа:

    {
        "cmd": "connection_answer",
        "params": {
            "oid": 2716057
            "сid": 1729
        }
    }

#### `get_game_params`:
Получение параметров игры.  
От: `client`.  
Ответ: `game_params`.  
Пример запроса:

    {
        "cmd": "get_game_params",
        "params": { }
    }

#### `game_params`:
Описывает параметры игры.  
От: `server`.  
Параметры:  
* `start_time` (uint64) - время начала в UNIX. В случае если равно 0 - оно ещё не известно;
* `step_time` (int) - время отведённое на 1 ход в секундах;
* `players` ([`player`]) - массив игроков, присоеденённых к игре;
* `error` (`error`) - поле ошибки (необязательное, в случе её отсутствия).

Пример ответа:

    {
        "cmd": "game_params",
        "params": {
            "start_time": 1609164794,
            "step_time": 1200,
            "players": [{
                "name": "Bender Bending Rodríguez",
                "oid": 2716057
            }, {
                "name": "Philip Jay Fry",
                "oid": 13194894195
            }]
        }
    }

### Процесс игры
*   `make_step` - уведомляет сервер о намерении сделать шаг. Также, способна изменить уже выбранны шаг при благоприятных условиях.  
    От: `client`.   
    Параметры: 
    * `step_id` - номер шага. Отсчёт с 1. Если данное поле принимает значение:
        * 0  - игра не началась;
        * -1 - игра завершилась.
    * `step_type` - тип шага. Допустимые значения: `up`, `right`, `down`, `left`.
    Ответ: `step_answer`.
*   `step` - просит информацию о текущем шаге.  
    От: `client`.
    Ответ: `step_answer`.
*   `step_answer` - уведомляет игрока об последнем шаге. 
    От: `server`.  
    Параметры: 
    * `step_id` - номер текущего шага.
    * `set_step_type` - тип последнего успешно установленного шага. Может принимать значение (по мимо выше указанных) `null`.
    * `step_end_time` - время окончания хода.
    * `error` - ErrorModel - ошибка (если есть)
*   `get_position` - уведомляет игрока об последнем шаге. 
    От: `client`.  
    Ответ: 
*   `position` - возвращает позицию игрока.
    От: `server`.  
    Параметры: 
    * `step_id` - номер текущего шага. -1 в случае окончания игры.
    * `up_border` - показывает наличие препядствия сверху. Возможные згачения: `free` или `obstacle`.
    * `right_border` - показывает наличие препядствия справа. Возможные згачения: `free` или `obstacle`.
    * `down_border` - показывает наличие препядствия снизу. Возможные згачения: `free` или `obstacle`.
    * `left_border` - показывает наличие препядствия слева. Возможные згачения: `free` или `obstacle`.
    
